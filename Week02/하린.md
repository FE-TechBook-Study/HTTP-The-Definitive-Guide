# 3장. HTTP 메시지

## 3.1 메시지의 흐름

HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들이다.  
이 메시지는 클라이언트, 서버, 프락시 사이를 흐른다.

### 3.1.1 메시지는 원 서버 방향을 인바운드로 하여 송신된다.

HTTP는 인바운드와 아웃바운드라는 용어를 트랜잭션 방향을 표현하기 위해 사용한다.

- 인바운드 : 메시지가 원 서버로 향하는 것
- 아웃바운드 : 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것

### 3.1.2 다운스트림으로 흐르는 메시지

HTTP 메시지는 요청/응답에 관계없이 모든 메시지는 다운스트림으로 흐른다. 메시지의 발송자는 수신자의 업스트림이다.

## 3.2 메시지의 각 부분

HTTP 메시지는 단순한, 데이터의 구조화된 블록으로 시작줄, 헤더 블록, 본문 세 부분으로 이루어진다.

시작줄과 헤더는 줄 단위로 분리된 아스키 문자열이다. 각 줄은 캐리지 리턴(CR, "\r")과 개행 문자(LF, "\n")로 구성된 두 글자의 줄바꿈 문자열로 끝난다. 이 문자열은 "CRLF"라고 쓴다.  
헤더의 목록은 빈줄로 끝나 헤더 목록의 끝과 엔터티 본문의 시작을 표시한다.
본문은 선택적인 데이터로 텍스트나 이진 데이터를 포함할 수도 있고 비어있을 수도 있다.  
헤더나 본문이 없더라도 HTTP 헤더의 집합은 항상 빈 줄로 끝나야한다.

### 3.2.1 메시지 문법

모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다.  
응답 메시지는 웹 서버에 어떤 동작을 요구한다. 응답 메시지는 요청의 결과를 클라에게 돌려준다. 둘 다 기본적으로 구조가 같다.

**요청 메시지 형식**

```text
<메서드> <요청 URL> <버전>
<헤더>

<엔터티 본문>

ex) GET /test/hi-there.txt HTTP 1.1
    _______________________________
    Accept: text/*
    Host: www.joes-hardware.com

    _______________________________
```

**응답 메시지 형식**

```text
<버전> <상태 코드> <사유 구절>
<헤더>

<엔터티 본문>

ex) HTTP/1.0 200 OK
    _______________________________
    Content-type: text/plain
    Content-length: 19

    _______________________________
    Hi! I'm a message!
```

### 3.2.2 시작줄

모든 HTTP 메시지는 시작줄로 시작한다.  
요청 메시지는 무엇을 해야하는지, 응답 메시지는 무슨일이 일어났는지 말해준다.

#### 요청줄

서버에서 어떤 동작이 일어나야 하는지 설명해주는 **메서드**와 그 동작에 대한 대상을 지칭하는 요청 **URL**이 들어있다.  
클라이언트가 어떤 HTTP 버전으로 말하고 있는지 서버에게 알려주는 **HTTP 버전**도 포함한다.

#### 응답줄

수행 결과에 대한 상태 정보와 결과 데이터를 클라에게 돌려준다.  
응답 메시지에서 쓰인 **HTTP의 버전, 숫자로된 상태 코드, 사유 구절**이 들어있다.

#### 메서드

요청의 시작줄은 메서드로 시작하며, 서버에게 무엇을 해야 하는지 말해준다.

| 메서드  | 설명                                                    | 메시지 본문이 있는가? |
| ------- | ------------------------------------------------------- | --------------------- |
| GET     | 서버에서 어떤 문서를 가져온다.                          | 없음                  |
| HEAD    | 서버에서 어떤 문서에 대해 헤더만 가져온다.              | 없음                  |
| POST    | 서버가 처리해야 할 데이터를 보낸다.                     | 있음                  |
| PUT     | 서버에 요청 메시지의 본문을 저장한다.                   | 있음                  |
| TRACE   | 메시지가 프록시를 거쳐 서버에 도달하는 과정을 추적한다. | 없음                  |
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다.         | 없음                  |
| DELETE  | 서버에서 문서를 제거한다.                               | 없음                  |

#### 상태코드

클라에게 무엇이 일어났는지 말해준다. 응답의 시작줄에 위치.  
상태 코드들은 세 자리 숫자로 된 코드값을 기준으로 묶인다.
| 전체 범위 | 정의된 범위 | 분류 |
|-----------|-------------|----|
| 100-199 | 100-101 | 정보 |
| 200-299 | 200-206 | 성공 |
| 300-399 | 300-305 | 리다이렉션 |
| 400-499 | 400-415 | 클라이언트 에러 |
| 500-599 | 500-505 | 서버 에러 |

#### 사유 구절

응답 시작줄의 마지막 구성요소. 상태 코드에 대한 글로된 설명을 제공한다.

#### 버전 번호

HTTP/x.y 형식으로 요청과 응답 메세지 양쪽 모두에 기술된다. HTTP 애플리케이션들이 자신이 따르는 프로토콜의 버전을 상대방에게 말해주기 위한 수단이 된다.  
버전 번호는 어떤 애플리케이션이 지원하는 가장 높은 HTTP 버전을 가리킨다. HTTP/1.1로 된 응답을 받았을 때 이는 응답을 보낸 애플리케이션이 HTTP/1.1까지 이해할 수 있음을 의미한다.

버전의 각 숫자는 분리된 숫자로 다루어진다. 어느 쪽이 더 큰지 버전을 비교할 때 각 숫자는 따로따로 비교해야 한다. 예를 들어 HTTP/2.22 는 HTTP/2.3 보다 크다
