웹 캐시는 자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP 장치다.

- 캐시는 불필요한 데이터 전송을 줄여서, 네트워크 요금으로 인한 비용을 줄여준다.
- 캐시는 네트워크 병목을 줄여준다. 대역폭을 늘리지 않고도 페이지를 빨리 불러올 수 있게 된다.
- 캐시는 원 서버에 대한 요청을 줄여준다. 서버는 부하를 줄일 수 있으며 더 빨리 응답할수 있게 된다.
- 페이지를 먼 곳에서 불러올수록 시간이 많이 걸리는데, 캐시는 거리로 인한 지연을 줄여준다.

# 1. 불필요한 데이터 전송

복수의 클라가 자주 쓰이는 원 서버 페이지에 접근할 때, 서버는 같은 문서를 클라이언트들에게 각각 한 번씩 전송하게 된다. 

똑같은 바이트들이 네트워크를 통해 계쏙 반복해서 이동한다.

이 불필요한 데이터 전송은 값비싼 네트워크 대역폭을 잡아먹고, 전송을 느리게 만들며, 웹 서버에 부하를 준다.

캐시를 이용하면, 첫 번째 서버 응답은 캐시에 보관된다.

캐시된 사본이 뒤이은 요청들에 대한 응답으로 사용될수 있기 때문에, 원 서버가 중복해서 트래픽을 주고받는 낭비가 줄어들게 된다.

# 2. 대역폭 병목

네트워크 병목을 줄여준다.

많은 네트워크가 원격 서버보다로컬 네트워크 클라이언트에 더 넓은 대역폭을 제공한다.

클라가 서버에 접근할 때의 속도는, 그 경로에 있는 가장 느린 네트워크의 속도와 같다.

만약 클라가 빠른 LAN에 있는 캐시로부터 사본을 가져온다면, 캐싱은 성능을 대폭 개선할수 있을 것이다. (특히 큰 문서에 대해서)

# 3. 갑작스런 요청 쇄도(Flash Crowds)

캐싱은 갑작스런 요청 쇄도에 대처하기 위해 특히 중요하다.

불필요한 트래픽 급증은 네트워크와 웹 서버의 심각한 장애를 일으킨다.

# 4. 거리로 인한 지연

대역폭이 문제가 되지 않더라도, 거리가 문제가 될 수 있다.

모든 네트워크 라우터는 제각각 인터넷 트래픽을 지연시킨다.

그리고 클라이언트와 서버 사이에 라우터가 그다지 많지 않더라도, 빛의 속도 그 자체가 유의미한 지연을 유발한다.

# 5. 적중과 부적중

캐시 적중(cache hit): 캐시에 요청이 도착했을 때, 대응하는 사본이 있다면 그를 이용해 요청이 처리된다.

캐시 부적중(cache miss): 대응하는 사본이 없다면 원 서버로 요청이 전달된다. 

![image.png](attachment:90634682-abda-4ace-b683-d9e2512c0ce8:image.png)

## 5.1 재검사 (Revalidation)

원 서버 콘텐츠는 변경될 수 있기 때문에, 캐시는 반드시 그들이 갖고 있는 사본이 최신인지 서버를 통해 점검해야 한다.

이러한 ‘신선도 검사’를 HTTP revalidation 이라 부른다.

효과적인 재검사를 위해, HTTP는 서버로부터 전체 객체를 가져오지 않고도 콘텐츠가 여전히 신선한지 빠르게 검사할 수 있는 특별한 요청을 정의했다.

캐시는 스스로 언제든지 사본을 재검사할 수 있다.

캐시는 캐시된 사본의 재검사가 필요할 때, 원 서버에 작은 재검사 요청을 보낸다.

캐시가 문서를 수백만 개씩 갖고 있는 경우가흔한데 비해 네트워크 대역폭은 부족하기 때문에, 대부분의 캐시는 클라이언트가 사본을 요청하였으며 그 사본이 검사를 할 피요가 있을 정도로 충분히 오래된 경우에만 재검사를 한다.

캐시는 캐시된 사본의 재검사가 필요할 때, 원 서버에 작은 재검사 요청을 보낸다.

콘텐츠가 변경되지 않았다면, 서버는 304 Not Modified 응답을 보낸다.

그 사본이 여전히 유효함을 알게 된 캐시는 사본이 신선하다고 임시로 다시 표시한 뒤 그 사본을 클라이언트에 제공한다.

이를 재검사 적중 혹은 느린 적중이라고 부른다.

이것은 순수 캐시 적중보다 느린데, 원 서버와 검사를 할 필요가 있기 때문이다.

그러나 캐시 부적중보다는 빠른데, 서버로부터 객체 데이터를 받아올 필요가 없기때문이다.

![image.png](attachment:e787920b-f3ea-4fba-bd3d-a2f0d254e1a5:image.png)

HTTP의 If-Modified-Since 헤더는, 서버에게보내는 GET요청에 캐시된 시간 이후에 변경된 경우에만 사본을 보내달라는의미로 추가할 수 있다.

GET If-Modified-Since 요청이 서버에 도착했을 때 일어날 수 있는 세 가지 상황.

서버 콘텐츠가 변경되지 않은 경우, 서버 콘텐츠가 변경된 경우, 객체가 삭제된 경우.

### 재검사 적중

만약 서버 객체가 변경되지 않았다면, 서버는 클라이언트에게 작은 HTTP 304 Not Modified 응답을 보낸다. 

![image.png](attachment:ca102c9a-5687-4789-9d90-b3da895977cd:image.png)

### 재검사 부적중

서버 객체가 캐시된 사본과 다르다면, 서버는 콘텐츠 전체와 함께 평범한 HTTP 200 OK 응답을 클라이언트에게 보낸다. 

### 객체 삭제

서버 객체가 삭제되었다면, 서버는 404 Not Found 응답을 돌려보내며, 캐시는 사본을 삭제한다.

## 5.2 적중률

캐시가 요청을 처리하는 비율을 캐시 적중률 혹은 문서 적중률이라고 부른다.

흔히 퍼센트로 표현되기도 한다. 

캐시 관리자는 캐시 적중률이 100%에 근접하게 되는 것을 좋아할 것이다.

실제 적중률은 캐시가 얼마나큰지, 캐시 사용자들의 관심사가 얼마나 비슷한지, 캐시된 데이터가 얼마나 자주 변경되거나 개인화되는지, 캐시가 어떻게 설정되어 있는지에 달려있다.

보통 크기의캐시라도 충분한 분량의 자주 쓰이는 문서들을 보관하여 상당히 트래픽을 줄이고 성능을 개선할 수 있다.

캐시는 유용한 콘텐츠가 캐시 안에 머무르도록 보장하기 위해 노력한다.

## 5.3 바이트 적중률

바이트 단위 적중률은 캐시를 통해 제공된 모든 바이트의 비율을 표현한다.

바이트 단위 적중률 100%는 모든 바이트가 캐시에서 왔으며, 어떤 트래픽도 인터넷으로 나가지 않았음을 의미한다. 

문서 적중률은 얼마나 많은 웹 트랜잭션을 외부로 내보내지 않았는지 보여준다.

트랜잭션은 고정된 소유 시간을 포함하게 되는데, 예를 들어 서버로의 TCP 커넥션을 맺는 경우 등, 문서 적중률을 개선하면 전체 대기시간(지연)이 줄어든다.

바이트 단위 적중률은 얼마나 많은 바이트가 인터넷으로 나가지 않았는지 보여준다. 바이트 단위 적중률의 개선은 대역폭 절약을 최적화한다. 

## 5.4 적중과 부적중의 구별
